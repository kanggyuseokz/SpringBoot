<!DOCTYPE html>
<html th:replace="~{components/layout :: layout(~{::title}, ~{::section})}" xmlns:th="http://www.thymeleaf.org">
<head>
    <title>λ§μ΄νμ΄μ§€ - FlashFolio</title>
</head>
<body>

<section class="container py-5">
    <h2 class="fw-bold mb-4"><i class="fa-solid fa-user-gear me-2"></i> λ§μ΄νμ΄μ§€</h2>

    <!-- νƒ­ λ„¤λΉ„κ²μ΄μ… -->
    <ul class="nav nav-tabs mb-4" id="myTab" role="tablist">
        <li class="nav-item" role="presentation">
            <button class="nav-link active fw-bold" id="portfolio-tab" data-bs-toggle="tab" data-bs-target="#portfolio-pane" type="button" role="tab">
                π“‚ λ‚΄ ν¬νΈν΄λ¦¬μ¤
            </button>
        </li>
        <li class="nav-item" role="presentation">
            <button class="nav-link fw-bold" id="password-tab" data-bs-toggle="tab" data-bs-target="#password-pane" type="button" role="tab">
                π”’ λΉ„λ°€λ²νΈ λ³€κ²½
            </button>
        </li>
    </ul>

    <!-- νƒ­ μ»¨ν…μΈ  -->
    <div class="tab-content" id="myTabContent">

        <!-- 1. ν¬νΈν΄λ¦¬μ¤ λ©λ΅ νƒ­ -->
        <div class="tab-pane fade show active" id="portfolio-pane" role="tabpanel">
            <div class="row row-cols-1 row-cols-md-2 row-cols-lg-3 g-4">
                <div class="col" th:each="p : ${portfolios}">
                    <div class="card h-100 shadow-sm border-0">
                        <div class="card-body">
                            <h5 class="card-title fw-bold text-truncate" th:text="${p.title}">Title</h5>
                            <p class="card-text text-muted small text-truncate" th:text="${p.summary}">Summary</p>
                            <div class="mb-2">
                                <span th:each="tech, iter : ${p.techStack}" th:if="${iter.index < 3}" class="badge bg-light text-dark border me-1" th:text="${tech}">Java</span>
                            </div>
                        </div>
                        <div class="card-footer bg-white border-top-0 text-end">
                            <a th:href="@{/p/{id}(id=${p.id})}" class="btn btn-sm btn-primary">λ³΄κΈ°</a>
                        </div>
                    </div>
                </div>
                <div class="col-12" th:if="${portfolios.isEmpty()}">
                    <div class="alert alert-light text-center py-5 border">
                        <p class="text-muted mb-3">μ•„μ§ μƒμ„±ν• ν¬νΈν΄λ¦¬μ¤κ°€ μ—†μµλ‹λ‹¤.</p>
                        <a href="/" class="btn btn-primary">μƒ ν¬νΈν΄λ¦¬μ¤ λ§λ“¤κΈ°</a>
                    </div>
                </div>
            </div>
        </div>

        <!-- 2. λΉ„λ°€λ²νΈ λ³€κ²½ νƒ­ -->
        <div class="tab-pane fade" id="password-pane" role="tabpanel">
            <div class="row justify-content-center">
                <div class="col-md-6">
                    <div class="card shadow-sm border-0">
                        <div class="card-body p-4">
                            <h5 class="card-title fw-bold mb-4">λΉ„λ°€λ²νΈ λ³€κ²½</h5>

                            <form th:action="@{/change-password}" method="post" th:object="${passwordChangeForm}">

                                <!-- μ—λ¬ λ©”μ‹μ§€ -->
                                <div th:if="${#fields.hasGlobalErrors()}" class="alert alert-danger">
                                    <div th:each="err : ${#fields.globalErrors()}" th:text="${err}"></div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">ν„μ¬ λΉ„λ°€λ²νΈ</label>
                                    <input type="password" class="form-control" th:field="*{currentPassword}"
                                           th:classappend="${#fields.hasErrors('currentPassword')} ? 'is-invalid'">
                                    <div class="invalid-feedback" th:errors="*{currentPassword}"></div>
                                </div>

                                <div class="mb-3">
                                    <label class="form-label">μƒ λΉ„λ°€λ²νΈ</label>
                                    <input type="password" class="form-control" th:field="*{newPassword}"
                                           th:classappend="${#fields.hasErrors('newPassword')} ? 'is-invalid'">
                                    <div class="form-text small">* 8μ μ΄μƒ, μλ¬Έ/μ«μ/νΉμλ¬Έμ ν¬ν•¨</div>
                                    <div class="invalid-feedback" th:errors="*{newPassword}"></div>
                                </div>

                                <div class="mb-4">
                                    <label class="form-label">μƒ λΉ„λ°€λ²νΈ ν™•μΈ</label>
                                    <input type="password" class="form-control" th:field="*{newPasswordRepeat}"
                                           th:classappend="${#fields.hasErrors('newPasswordRepeat')} ? 'is-invalid'">
                                    <div class="invalid-feedback" th:errors="*{newPasswordRepeat}"></div>
                                </div>

                                <button type="submit" class="btn btn-dark w-100">λ³€κ²½ν•κΈ°</button>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- νƒ­ μ μ§€μ© μ¤ν¬λ¦½νΈ (νΌ μ—λ¬ μ‹ λΉ„λ°€λ²νΈ νƒ­ μ—΄λ ¤μκ²) -->
<script>
    document.addEventListener("DOMContentLoaded", function() {
        const urlParams = new URLSearchParams(window.location.search);
        // URLμ— ?tab=passwordκ°€ μκ±°λ‚, νΌ μ—λ¬(.is-invalid)κ°€ μμΌλ©΄ λΉ„λ°€λ²νΈ νƒ­ ν™μ„±ν™”
        if (urlParams.get('tab') === 'password' || document.querySelector('.is-invalid')) {
            const triggerEl = document.querySelector('#password-tab');
            const tab = new bootstrap.Tab(triggerEl);
            tab.show();
        }
    });
</script>

</body>
</html>